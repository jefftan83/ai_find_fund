# åŸºé‡‘æ¨èåŠ©æ‰‹ (Fund Advisor)

å¤š Agent CLI åŸºé‡‘æ¨èç¨‹åºï¼Œé€šè¿‡å¯¹è¯ä¸ºæ‚¨æ¨èåˆé€‚çš„åŸºé‡‘ç»„åˆã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¤– **å¤š Agent æ¶æ„**ï¼šéœ€æ±‚åˆ†æã€é£é™©è¯„ä¼°ã€åŸºé‡‘æ¨èä¸‰ä¸ªä¸“ä¸š Agent åä½œ
- ğŸ“Š **å¤šå±‚æ¬¡æ•°æ®æº**ï¼šAKShareï¼ˆä¸»ï¼‰+ Tushare + æ–°æµªè´¢ç» + èšå®½ï¼ˆå¤‡ç”¨ï¼‰
- ğŸ’¾ **æœ¬åœ°ç¼“å­˜**ï¼šSQLite ç¼“å­˜ï¼Œå‡å°‘ API è°ƒç”¨
- ğŸ¯ **ä¸ªæ€§åŒ–æ¨è**ï¼šæ ¹æ®æ‚¨çš„æŠ•èµ„ç›®æ ‡å’Œé£é™©æ‰¿å—èƒ½åŠ›æ¨èåŸºé‡‘
- ğŸ’» **å‘½ä»¤è¡Œç•Œé¢**ï¼šç®€æ´ç¾è§‚çš„ TUI äº¤äº’

## å®‰è£…

### 1. å…‹éš†é¡¹ç›®

```bash
cd ai_find_fund
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -e .
```

### 3. é…ç½® API Key

å¤åˆ¶é…ç½®æ–‡ä»¶å¹¶ç¼–è¾‘ï¼š

```bash
cp config.yaml.example config.yaml
```

ç¼–è¾‘ `config.yaml`ï¼Œå¡«å…¥ Anthropic API Keyï¼š

```yaml
anthropic_api_key: "sk-ant-..."
```

æˆ–è€…è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export ANTHROPIC_API_KEY=sk-ant-...
```

## ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨ç¨‹åº

```bash
fund-advisor start
```

æˆ–ï¼š

```bash
python -m src.main start
```

### æŸ¥çœ‹é…ç½®çŠ¶æ€

```bash
fund-advisor config-status
```

### æŸ¥çœ‹ç‰ˆæœ¬

```bash
fund-advisor version
```

## æ•°æ®åŠ è½½è„šæœ¬

### ä¸»æ•°æ®åŠ è½½å·¥å…·ï¼ˆæ‰‹åŠ¨æ“ä½œï¼‰

```bash
python3 scripts/data_loader.py
```

æä¾› 10 ä¸ªæ•°æ®åŠ è½½é€‰é¡¹ï¼š
- åŠ è½½åŸºé‡‘åŸºæœ¬ä¿¡æ¯ã€è¯„çº§ã€æŒä»“
- åŠ è½½å½“æ—¥å‡€å€¼ã€å†å²å‡€å€¼
- åŠ è½½åŸºé‡‘è§„æ¨¡æ•°æ®

### æ¯æ—¥è‡ªåŠ¨æ›´æ–°ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰

```bash
python3 scripts/daily_update.py
```

æ¯æ—¥è‡ªåŠ¨æ‰§è¡Œï¼š
- å½“æ—¥å‡€å€¼ï¼ˆæ¯æ—¥ï¼‰
- åŸºé‡‘è§„æ¨¡ï¼ˆæ¯å‘¨ï¼Œä»…ç¼ºå¤±æ•°æ®ï¼‰
- åŸºé‡‘è¯„çº§ã€æŒä»“ï¼ˆæ¯æœˆï¼‰

**é…ç½®è¯´æ˜**ï¼šç¼–è¾‘ `scripts/daily_update.py` é¡¶éƒ¨çš„ `CONFIG` é…ç½®é¡¹

### è„šæœ¬å˜æ›´è¯´æ˜ï¼ˆv2.0ï¼‰

ä»¥ä¸‹è„šæœ¬å·²è¿ç§»åˆ° `data_loader.py`ï¼Œä¸å†å•ç‹¬ç»´æŠ¤ï¼š
- `init_fund_db.py` â†’ `data_loader.py` é€‰é¡¹ 1
- `load_fund_history.py` â†’ `data_loader.py` é€‰é¡¹ 5
- `load_fund_history_batch.py` â†’ `data_loader.py` é€‰é¡¹ 6,7
- `load_all_size.py` â†’ `data_loader.py` é€‰é¡¹ 8
- `load_missing_size.py` â†’ å·²æ•´åˆåˆ° `daily_update.py`

## å¯¹è¯æµç¨‹

1. **éœ€æ±‚åˆ†æ**ï¼šäº†è§£æŠ•èµ„é‡‘é¢ã€æœŸé™ã€ç›®æ ‡ç­‰
2. **é£é™©è¯„ä¼°**ï¼šè¯„ä¼°é£é™©æ‰¿å—èƒ½åŠ›ï¼Œç»™å‡ºé£é™©ç­‰çº§
3. **åŸºé‡‘æ¨è**ï¼šæ ¹æ®ç”»åƒæ¨è 3-5 åªåŸºé‡‘

## é£é™©ç­‰çº§è¯´æ˜

| ç­‰çº§ | ç‰¹ç‚¹ | æ¨èåŸºé‡‘ç±»å‹ |
|------|------|-------------|
| ä¿å®ˆå‹ | ä¸èƒ½æ¥å—æœ¬é‡‘æŸå¤± | è´§å¸åŸºé‡‘ã€çŸ­å€ºåŸºé‡‘ |
| ç¨³å¥å‹ | èƒ½æ‰¿å— 5-10% æ³¢åŠ¨ | å€ºåˆ¸åŸºé‡‘ã€å›ºæ”¶ +ã€å¹³è¡¡æ··åˆ |
| ç§¯æå‹ | èƒ½æ‰¿å— 10-20% æ³¢åŠ¨ | åè‚¡æ··åˆã€æŒ‡æ•°å¢å¼º |
| æ¿€è¿›å‹ | èƒ½æ‰¿å— 20% ä»¥ä¸Šæ³¢åŠ¨ | è‚¡ç¥¨å‹ã€è¡Œä¸šä¸»é¢˜åŸºé‡‘ |

## æ•°æ®æº

- **ä¸»æ•°æ®æº**ï¼šAKShareï¼ˆå¤©å¤©åŸºé‡‘/ä¸œæ–¹è´¢å¯Œæ•°æ®ï¼‰
- **å¤‡ç”¨ 1**ï¼šTushareï¼ˆéœ€æ³¨å†Œï¼‰
- **å¤‡ç”¨ 2**ï¼šæ–°æµªè´¢ç»ï¼ˆå®æ—¶è¡Œæƒ…ï¼‰
- **å¤‡ç”¨ 3**ï¼šèšå®½ï¼ˆéœ€æ³¨å†Œï¼‰

## æ‰“åŒ…å‘å¸ƒ

### macOS / Linux

```bash
pyinstaller --onefile --name fund-advisor src/main.py
```

### Windows

```bash
pyinstaller --onefile --name fund-advisor src\main.py
```

æ‰“åŒ…åçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨ `dist/` ç›®å½•ä¸­ã€‚

## é¡¹ç›®ç»“æ„

```
ai_find_fund/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py              # CLI å…¥å£
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ manager.py       # ç¾¤èŠç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ requirement.py   # éœ€æ±‚åˆ†æ Agent
â”‚   â”‚   â”œâ”€â”€ risk.py          # é£é™©è¯„ä¼° Agent
â”‚   â”‚   â””â”€â”€ fund_expert.py   # åŸºé‡‘ä¸“å®¶ Agent
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ fund_data.py     # æ•°æ®æœåŠ¡ï¼ˆå¤šæºèåˆï¼‰
â”‚   â”‚   â”œâ”€â”€ akshare_client.py
â”‚   â”‚   â”œâ”€â”€ tushare_client.py
â”‚   â”‚   â”œâ”€â”€ sina_client.py
â”‚   â”‚   â””â”€â”€ jq_client.py
â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â””â”€â”€ db.py            # SQLite ç¼“å­˜
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ llm.py           # Claude API å°è£…
â”œâ”€â”€ config.yaml.example      # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
â””â”€â”€ README.md
```

## æ•°æ®åº“è¡¨ç»“æ„

æ•°æ®å­˜å‚¨äº `~/.ai_find_fund/fund_cache.db`ï¼ˆSQLiteï¼‰

### 1. fund_basic - åŸºé‡‘åŸºæœ¬ä¿¡æ¯è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|:------:|:----:|:-----|
| `fund_code` | TEXT | **ä¸»é”®** - åŸºé‡‘ä»£ç ï¼ˆå¦‚ï¼š000001ï¼‰ |
| `fund_name` | TEXT | åŸºé‡‘åç§° |
| `fund_type` | TEXT | åŸºé‡‘ç±»å‹ï¼ˆæ··åˆå‹ã€å€ºåˆ¸å‹ã€è‚¡ç¥¨å‹ç­‰ï¼‰ |
| `company` | TEXT | åŸºé‡‘ç®¡ç†äºº/åŸºé‡‘å…¬å¸ |
| `manager` | TEXT | åŸºé‡‘ç»ç† |
| `established_date` | TEXT | æˆç«‹æ—¥æœŸ |
| `net_asset_size` | TEXT | **å‡€èµ„äº§è§„æ¨¡**ï¼ˆå¦‚ï¼š"10.5 äº¿"ï¼‰ |
| `share_size` | TEXT | **ä»½é¢è§„æ¨¡**ï¼ˆå¦‚ï¼š"9.8 äº¿ä»½"ï¼‰ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¶é—´ |

### 2. fund_nav - åŸºé‡‘å‡€å€¼è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|:------:|:----:|:-----|
| `id` | INTEGER | **ä¸»é”®** - è‡ªå¢ |
| `fund_code` | TEXT | åŸºé‡‘ä»£ç  |
| `nav_date` | DATE | å‡€å€¼æ—¥æœŸ |
| `unit_nav` | REAL | å•ä½å‡€å€¼ |
| `accumulated_nav` | REAL | ç´¯è®¡å‡€å€¼ |
| `daily_growth` | REAL | æ—¥å¢é•¿ç‡ |
| `created_at` | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

**å”¯ä¸€çº¦æŸ**: `(fund_code, nav_date)`

### 3. fund_holdings - åŸºé‡‘æŒä»“è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|:------:|:----:|:-----|
| `id` | INTEGER | **ä¸»é”®** - è‡ªå¢ |
| `fund_code` | TEXT | åŸºé‡‘ä»£ç  |
| `report_date` | DATE | æŠ¥å‘ŠæœŸ |
| `stock_code` | TEXT | è‚¡ç¥¨ä»£ç  |
| `stock_name` | TEXT | è‚¡ç¥¨åç§° |
| `holding_ratio` | REAL | å å‡€å€¼æ¯”ä¾‹ï¼ˆ%ï¼‰ |
| `holding_amount` | INTEGER | æŒè‚¡æ•°é‡ |
| `holding_value` | REAL | æŒä»“å¸‚å€¼ |
| `stock_type` | TEXT | è‚¡ç¥¨ç±»å‹ |
| `created_at` | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### 4. fund_rating - åŸºé‡‘è¯„çº§è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|:------:|:----:|:-----|
| `id` | INTEGER | **ä¸»é”®** - è‡ªå¢ |
| `fund_code` | TEXT | åŸºé‡‘ä»£ç  |
| `rating_date` | DATE | è¯„çº§æ—¥æœŸ |
| `rating_agency` | TEXT | è¯„çº§æœºæ„ |
| `rating_1y` | INTEGER | 1 å¹´æœŸè¯„çº§ï¼ˆ1-5 æ˜Ÿï¼‰ |
| `rating_2y` | INTEGER | 2 å¹´æœŸè¯„çº§ |
| `rating_3y` | INTEGER | 3 å¹´æœŸè¯„çº§ |
| `created_at` | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### 5. update_log - æ•°æ®æ›´æ–°æ—¥å¿—è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|:------:|:----:|:-----|
| `id` | INTEGER | **ä¸»é”®** - è‡ªå¢ |
| `data_type` | TEXT | æ•°æ®ç±»å‹ï¼ˆfund_listã€daily_nav ç­‰ï¼‰ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¶é—´ |
| `status` | TEXT | çŠ¶æ€ï¼ˆsuccess/errorï¼‰ |
| `message` | TEXT | æ›´æ–°æ¶ˆæ¯/é”™è¯¯ä¿¡æ¯ |

## å¼€å‘

```bash
# å¼€å‘æ¨¡å¼å®‰è£…
pip install -e ".[dev]"

# è¿è¡Œæµ‹è¯•
python -m pytest
```

## æ³¨æ„äº‹é¡¹

âš ï¸ **æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…**

æœ¬ç¨‹åºä»…æä¾›åŸºé‡‘æ¨èå‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„å‰è¯·ï¼š
- ä»”ç»†é˜…è¯»åŸºé‡‘åˆåŒã€æ‹›å‹Ÿè¯´æ˜ä¹¦
- äº†è§£åŸºé‡‘çš„é£é™©æ”¶ç›Šç‰¹å¾
- æ ¹æ®è‡ªèº«æƒ…å†µåšå‡ºç‹¬ç«‹åˆ¤æ–­

## License

MIT
